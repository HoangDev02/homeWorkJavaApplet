package com.oracle.jcclassic.samples.helloworld;

import javacard.framework.APDU;
import javacard.framework.Applet;
import javacard.framework.ISO7816;
import javacard.framework.ISOException;
import javacard.framework.Util;

public class HelloWorld extends Applet {
    private static final byte[] TARGET_DATA = { 'D', 'A', 'T', 'A', '_', 'A', 'B', 'C', 'D' };
    private static final byte CLA = (byte) 0xB0; // Class byte
    private static final byte INS_COMPARE = (byte) 0x01; // Instruction byte
    private static final byte SIZE_OK = (byte) 0x00; // Result byte for true
    private static final byte SIZE_NOT_OK = (byte) 0xFF; // Result byte for false

    /**
     * Only this class's install method should create the applet object.
     */
    protected HelloWorld() {
        register();
      
    }

    /**
     * Installs this applet.
     *
     * @param bArray  the array containing installation parameters
     * @param bOffset the starting offset in bArray
     * @param bLength the length in bytes of the parameter data in bArray
     */
    public static void install(byte[] bArray, short bOffset, byte bLength) {
        new HelloWorld();
    }

    /**
     * Processes an incoming APDU.
     *
     * @see APDU
     * @param apdu the incoming APDU
     * @exception ISOException with the response bytes per ISO 7816-4
     */
    @Override
    public void process(APDU apdu) {
    	byte[] buffer = apdu.getBuffer();
        if (selectingApplet()) {
            return;
        }

        // Check if the command is for comparison
        if (buffer[ISO7816.OFFSET_CLA] != CLA) {
            ISOException.throwIt(ISO7816.SW_CLA_NOT_SUPPORTED);
        }

        if (buffer[ISO7816.OFFSET_INS] == INS_COMPARE) {
            // Get the length of the input data
            byte dataLength = buffer[ISO7816.OFFSET_LC];
            byte[] inputData = new byte[dataLength];
            Util.arrayCopy(buffer, ISO7816.OFFSET_CDATA, inputData, (short) 0, dataLength);

            // Compare the input data with TARGET_DATA
            if (dataLength == TARGET_DATA.length && Util.arrayCompare(inputData, (short) 0, TARGET_DATA, (short) 0, TARGET_DATA.length) == 0) {
                buffer[0] = SIZE_OK; // true
                apdu.setOutgoingAndSend((short) 0, (short) 1);
            } else {
                buffer[0] = SIZE_NOT_OK; // false
                apdu.setOutgoingAndSend((short) 0, (short) 1);
            }
        } else {
            ISOException.throwIt(ISO7816.SW_INS_NOT_SUPPORTED);
        }
    }
}
